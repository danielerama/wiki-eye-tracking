<!DOCTYPE html>

<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Experiment</title>

		<link rel="stylesheet" type="text/css" href="static/style.css">

		<script src="/static/webgazer.js"></script>
		<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
		<script src="//code.jquery.com/jquery-1.10.2.js"></script>

		<script>
			function startEyeTracking() {
				webgazer.setGazeListener(function(data, elapsedTime) {
					if (data == null) return;

					let el = document.elementFromPoint(data.x, data.y);
					if (el instanceof HTMLIFrameElement) {
						targetEl = el.contentWindow.document.elementFromPoint(data.x, data.y);
						if (targetEl.nodeName == "IMG" || targetEl.nodeName == "P" || (targetEl.nodeName == "SPAN" & targetEl.classList.contains("mw-headline"))) { 
							targetEl.style.opacity = .3; 
						} else {
							let elems = el.contentWindow.document.querySelectorAll("img, p, span.mw-headline");
							for (let i=0; i<elems.length; i++) {
								elems[i].style.opacity = 1;
							}
						}
					}
					})
					.saveDataAcrossSessions(true)
					.begin();

				webgazer.setTracker("TFFacemesh");
				webgazer.setRegression("ridge");

				webgazer.showVideoPreview(false) /* shows all video previews */
					.showPredictionPoints(true) /* shows a square every 100 milliseconds where current prediction is */
					.applyKalmanFilter(true); /* Kalman Filter defaults to on. Can be toggled by user. */

				webgazer.removeMouseEventListeners();
			}
		</script>
	</head>
	<body>
		<iframe src="/show_wiki_page" width="100%" height="100%"></iframe>

		<script>
			startEyeTracking();
		</script>
	</body>
</html>